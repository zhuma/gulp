/**
 * Created by hanshaojie on 2016/11/23.
 */
var commonData = [
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 3,
        "name": "桂花",
        "pinYin": "guihua"
    },
    {
        "id": 11,
        "name": "扁豆花",
        "pinYin": "biandouhuaL"
    },
    {
        "id": 13,
        "name": "打箭菊",
        "pinYin": "dajianju"
    },
    {
        "id": 14,
        "name": "芙蓉花",
        "pinYin": "furonghua"
    },
    {
        "id": 16,
        "name": "款冬花",
        "pinYin": "kuandonghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    },
    {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }, {
        "id": 17,
        "name": "密蒙花",
        "pinYin": "mimenghua"
    }
];
//常用品类
$(function () {
    focusFn("mPage1","medicinal-name-list1","common-name");
    fFn("hPage","h","hh");
    //隐藏搜索框
    $(document).click(function (ev) {
        var e = ev || window.event;
        var elem = e.target || e.srcElement;
        while (elem) {
            if ($(elem).attr("href") == "javascript:;") {
                return;
            }
            elem = elem.parentNode;
        }
        $(".medicinal-name-list").hide().siblings("input").removeClass();
    });

    //分页
    function pageTwo(cont,arr,lId,tId) {
        //显示分页
        laypage({
            cont: $("."+cont),
            pages: Math.ceil(arr.length / 12),
            groups:4,
            first: false, //将首页显示为数字1,。若不显示，设置false即可
            last: Math.ceil(arr.length / 12), //将尾页显示为总页数。若不显示，设置false即可
            prev: '<', //若不显示，设置false即可
            next: '>', //若不显示，设置false即可
            curr: 1, //当前页
            jump: function (obj) { //触发分页后的回调
                linkName(arr,lId,tId, (obj.curr - 1) * 12, (obj.curr - 1) * 12 + 12);
            }
        });
    }
    /*聚焦产品名称*/
    function focusFn(cont,lId,tId) {
        $(document).on("click","#"+tId,function (e) {
            e.stopPropagation();
            $(".medicinal-name-list").hide().siblings("input").removeClass();
            $(this).siblings(".medicinal-name-list").show();
            $(this).addClass("bd");
            select(cont,commonData,lId,tId);
            pageTwo(cont,commonData,lId,tId);
        });
    }
    function fFn(cont,lId,tId) {
        $(document).on("click","#"+tId,function (e) {
            e.stopPropagation();
            $(".medicinal-name-list").hide().siblings("input").removeClass();
            $(this).siblings(".medicinal-name-list").show();
            $(this).addClass("hd");
            select(cont,commonData,lId,tId);
            pageTwo(cont,commonData,lId,tId);
        });
    }

    /*检索*/
    function select(cont,data,lId,tId) {
        var obj = $("#"+tId);
        obj.keyup(function () {
            var newArr = [];
            var curVal = $(this).val();
            for (var i = 0; i < data.length; i++) {
                if (data[i].pinYin.indexOf(curVal.toLowerCase()) === 0 || data[i].name.indexOf(curVal) === 0) {
                    newArr.push(data[i]);
                }
            }
           obj.blur(function () {
                if (newArr.length === 0) {
                    $(this).val("");
                }
            });
            pageTwo(cont,newArr,lId,tId);
        });
    }

    /*联动创建产品名称列表*/
    function linkName(dataArr, conObj, valObj, start, end) {
        var oCon = $("#" + conObj);
        var oVal = $("#" + valObj);
        var sHtml = "";
        var data = sortByKey(dataArr, "pinYin");
        var showLen = data.length;
        oCon.children().remove();
        oVal.prop("readonly", false);
        if (end >= showLen) {
            end = showLen;
        }
        for (var i = start; i < end; i++) {
            sHtml += "<li data-id='" + data[i].id + "'>" + data[i].name + "</li>";
        }
        oCon.append(sHtml);

        //点选
        $(document).on("click", "#" + conObj + ">li", function (e) {
            e.stopPropagation();
            oVal.val($(this).text());
            oVal.attr("data-id", $(this).attr("data-id"));
            $(".medicinal-name-list").hide().siblings("input").removeClass();
        });
    }

    /*高级医师首次登陆问卷调查 - 创建节点*/
    var iDelIndex = 1,count = 1;
    $("#editable-add").click(function () {
        var oEle = '';
        oEle += '<tr>';
        oEle += '<td class="pr">';
        oEle += "<input type='text' id='hh"+count+"'>";
        oEle += "<div class='medicinal-name-list cName'>";
        oEle += "<ul id='h"+count+"'></ul>";
        oEle += "<div class='mPage hPage"+count+"'></div>";
        oEle += "</div>";
        oEle += '</td>';
        oEle += '<td><input type="text"></td>';
        oEle += '<td><input type="text"></td>';
        oEle += '<td><input type="text"></td>';
        oEle += '<td><input type="text"></td>';
        oEle += '<td><a href="javascript:;" class="del-table">删除</a></td>';
        oEle += '</tr>';
        fFn("hPage"+count,"h"+count,"hh"+count);
        $("#editable tbody").append(oEle);
        count++;
    });

    /*添加事件*/
    $(document).on("click", ".del-table", function () {
        lockScreen($(".confirm-del-dialog"));
        iDelIndex = $(this).parent().parent().index();
    });
    $(document).on("click", ".operate-del-confirm", function () {
        var allTr = $("#editable>tbody>tr");
        if (allTr.length <= 2) {
            return alert("请您至少维护一种品类信息");
        }
        allTr.eq(iDelIndex).remove();
    });


});























